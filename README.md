# Telegram bot + Mini App

## Что реализовано

- При первом `/start` бот предлагает регистрацию.
- При регистрации запрашиваются `ФИО` и `Организация`.
- Все новые пользователи регистрируются с ролью `Пользователь`.
- После успешной регистрации пользователь сохраняется в `users.json`.
- При повторном `/start` бот пишет, что пользователь уже зарегистрирован и показывает роль.
- Для роли `Пользователь` доступна кнопка `Оставить заявку`.
- Для роли `Пользователь` доступна кнопка `Предложения по доработке!`:
  - пользователь отправляет предложение одним сообщением,
  - предложение сохраняется в `suggestions.json`,
  - админы получают уведомление о новом предложении.
- Для ролей `Пользователь` и `Админ` доступна кнопка `Инструкции` с подпунктами:
  - `Настройки`
  - `Виджеты`
  - `Страницы`
  - `Кнопки`
  - `Установка на Windows 11`
- По каждому подпункту бот отправляет HTML-файл инструкции.
- Для ролей `Пользователь` и `Админ` доступна кнопка `Открыть приложение`,
  которая открывает Telegram Mini App по URL из `WEB_APP_URL`.
- После отправки текста заявки бот уведомляет всех зарегистрированных админов.
- Для роли `Админ` добавлено меню:
  - `Список заявок` (показывает `NEW` и `IN_PROGRESS`),
  - `Принять в работу` (переводит заявку в `IN_PROGRESS`),
  - `Открыть диалог` (только для своих заявок в `IN_PROGRESS`),
  - `Завершить заявку` (переводит в `COMPLETED` и закрывает диалог),
  - `Предложения по доработке!` (показывает все присланные предложения).
- Перед диалогом админ обязан принять заявку в работу.
- При смене статуса пользователь получает уведомление: заявка принята в работу / заявка завершена.
- Диалог между админом и пользователем работает только пока статус заявки `IN_PROGRESS`.

## Запуск

1. Установить зависимости:

```bash
npm install
```

2. Создать файл `.env` на основе `.env.example` и прописать токен:

```env
BOT_TOKEN=ваш_токен_бота
WEB_APP_URL=https://sharlayvlad.github.io/adaptlink_support/webapp/
```

3. Запустить (с автоперезапуском при изменениях кода):

```bash
npm start
```

## Структура

- `index.js` - логика бота
- `webapp/index.html` - минимальный фронтенд Telegram Mini App
- `users.json` - база зарегистрированных пользователей (создается автоматически)
- `requests.json` - список заявок пользователей (создается автоматически)
- `suggestions.json` - список предложений по доработке (создается автоматически)
- `instructions_html/` - тестовые HTML-инструкции для разделов
